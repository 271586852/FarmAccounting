<view class="container">
  <!-- æ—¥æœŸé€‰æ‹©åŒºåŸŸ -->
  <view class="date-header">
    <view class="date-picker" bindtap="showCalendar" hover-class="none">
      <text class="date-text">{{dateDisplay}}</text>
      <image class="date-icon" src="../../image/calendar.png" mode="aspectFit"></image>
    </view>
  </view>
  
  <!-- æ—¥å†ç»„ä»¶ -->
  <calendar selectedDate="{{currentDate}}" show="{{showCalendar}}" bindselect="onDateSelect" bindclose="hideCalendar"></calendar>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="top-actions">
    <button class="action-btn primary-btn" bindtap="showAddModal">æ¥é¾™è§£æ</button>
    <button class="action-btn secondary-btn" bindtap="exportJielong">æ¥é¾™å¯¼å‡º</button>
    <button class="action-btn clear-btn" bindtap="clearAll">æ¸…é™¤</button>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="statistics-bar">
    <view class="stat-item">
      <text class="stat-label">æ€»æ¡”æ•°</text>
      <text class="stat-value">{{statistics.totalJu}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">æ€»è´¡æ•°</text>
      <text class="stat-value">{{statistics.totalGong}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">æ€»æ··æ•°</text>
      <text class="stat-value">{{statistics.totalMixed}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">æ€»æ•°</text>
      <text class="stat-value">{{statistics.totalAll}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">è®°å½•æ•°</text>
      <text class="stat-value">{{statistics.totalCount}}</text>
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="records-list">
    <view wx:if="{{records.length === 0}}" class="empty-tip">
      æš‚æ— è®°å½•
    </view>
    <view wx:for="{{records}}" wx:for-index="idx" wx:key="_id" class="record-item" data-id="{{item._id}}" bindtap="onRecordTap">
      <view class="record-content">
        <view class="record-header">
          <view class="record-left">
            <view class="record-index">{{idx + 1}}</view>
            <view class="recorder-name">{{item.recorder}}</view>
          </view>
          <view class="record-time">{{item.createTimeDisplay}}</view>
        </view>
        <view class="record-details">
          <view class="detail-row" wx:if="{{item.recipient}}">
            <text class="detail-label">æ”¶ä»¶äººï¼š</text>
            <text class="detail-value">{{item.recipient}}</text>
          </view>
          <view class="detail-row" wx:if="{{item.phone}}">
            <text class="detail-label">ç”µè¯ï¼š</text>
            <text class="detail-value">{{item.phone}}</text>
          </view>
          <view class="detail-row" wx:if="{{item.address}}">
            <text class="detail-label">åœ°å€ï¼š</text>
            <text class="detail-value address-text">{{item.address}}</text>
          </view>
          <view class="detail-row" wx:if="{{item.remark}}">
            <text class="detail-label">å¤‡æ³¨ï¼š</text>
            <text class="detail-value remark-text">{{item.remark}}</text>
          </view>
          <view class="detail-row quantity-row">
            <text class="quantity-item" wx:if="{{item.quantityJu > 0}}">{{item.quantityJu}}æ¡”</text>
            <text class="quantity-item" wx:if="{{item.quantityGong > 0}}">{{item.quantityGong}}è´¡</text>
            <text class="quantity-item" wx:if="{{item.quantityMixed > 0}}">{{item.quantityMixed}}æ··</text>
          </view>
        </view>
      </view>
      <view class="delete-btn" data-id="{{item._id}}" data-index="{{index}}" catchtap="deleteRecord">
        <image class="delete-icon" src="../../image/delete.png" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ å¼¹çª— -->
  <view wx:if="{{showAddModal}}" class="modal-mask" bindtap="hideAddModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç²˜è´´æ¥é¾™å†…å®¹</text>
        <view class="modal-close" bindtap="hideAddModal">Ã—</view>
      </view>
      <view class="modal-body">
        <textarea 
          class="paste-textarea" 
          placeholder="è¯·ç²˜è´´æ¥é¾™å†…å®¹ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è§£æ..."
          value="{{pasteContent}}"
          bindinput="onPasteInput"
          auto-height
          maxlength="5000"
        ></textarea>
        <view class="modal-tip">
          <text>ğŸ’¡ æç¤ºï¼šæ”¯æŒæ¥é¾™æ ¼å¼ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§£æè®°å½•äººã€åœ°å€ã€æ”¶ä»¶äººã€ç”µè¯ã€æ•°é‡ç­‰ä¿¡æ¯</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="hideAddModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm-btn" bindtap="parseAndSave">è§£æå¹¶ä¿å­˜</button>
      </view>
    </view>
  </view>

  <!-- å¯¼å‡ºé¢„è§ˆå¼¹çª— -->
  <view wx:if="{{showExportModal}}" class="modal-mask" bindtap="hideExportModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">æ¥é¾™å¯¼å‡ºé¢„è§ˆ</text>
        <view class="modal-close" bindtap="hideExportModal">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="modal-tip">
          <text>é•¿æŒ‰ä¸‹æ–¹æ–‡æœ¬æ¡†æ‰‹åŠ¨å¤åˆ¶</text>
        </view>
        <textarea 
          class="export-textarea"
          value="{{exportText}}"
          auto-height
          maxlength="-1"
          show-confirm-bar="{{false}}"
        ></textarea>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="hideExportModal">å…³é—­</button>
      </view>
    </view>
  </view>

  <!-- ç¼–è¾‘å¼¹çª— -->
  <view wx:if="{{showEditModal}}" class="modal-mask" bindtap="hideEditModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç¼–è¾‘å¿«é€’è®°å½•</text>
        <view class="modal-close" bindtap="hideEditModal">Ã—</view>
      </view>
      <view class="modal-body edit-body">
        <view class="form-item">
          <text class="form-label">ç™»è®°äºº</text>
          <input class="form-input" value="{{editRecord.recorder}}" data-field="recorder" bindinput="onEditInput" placeholder="ç™»è®°äºº"/>
        </view>
        <view class="form-item">
          <text class="form-label">æ”¶ä»¶äºº</text>
          <input class="form-input" value="{{editRecord.recipient}}" data-field="recipient" bindinput="onEditInput" placeholder="æ”¶ä»¶äºº"/>
        </view>
        <view class="form-item">
          <text class="form-label">ç”µè¯</text>
          <input class="form-input" type="number" value="{{editRecord.phone}}" data-field="phone" bindinput="onEditInput" placeholder="æ‰‹æœºå·"/>
        </view>
        <view class="form-item">
          <text class="form-label">åœ°å€</text>
          <textarea class="form-textarea" value="{{editRecord.address}}" data-field="address" bindinput="onEditInput" placeholder="åœ°å€" auto-height></textarea>
        </view>
        <view class="form-row">
          <view class="form-item small">
            <text class="form-label">æ¡”</text>
            <input class="form-input" type="number" value="{{editRecord.quantityJu}}" data-field="quantityJu" bindinput="onEditInput" />
          </view>
          <view class="form-item small">
            <text class="form-label">è´¡</text>
            <input class="form-input" type="number" value="{{editRecord.quantityGong}}" data-field="quantityGong" bindinput="onEditInput" />
          </view>
          <view class="form-item small">
            <text class="form-label">æ··</text>
            <input class="form-input" type="number" value="{{editRecord.quantityMixed}}" data-field="quantityMixed" bindinput="onEditInput" />
          </view>
        </view>
        <view class="form-item">
          <text class="form-label">å¤‡æ³¨</text>
          <input class="form-input" value="{{editRecord.remark}}" data-field="remark" bindinput="onEditInput" placeholder="å¤‡æ³¨"/>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="hideEditModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm-btn" bindtap="saveEdit">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>

