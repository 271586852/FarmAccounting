<view class="container">
  <!-- æ—¥æœŸé€‰æ‹©åŒºåŸŸ -->
  <view class="date-header">
    <view class="date-picker" bindtap="showCalendar" hover-class="none">
      <text class="date-text">{{dateDisplay}}</text>
      <image class="date-icon" src="../../image/calendar.png" mode="aspectFit"></image>
    </view>
  </view>
  
  <!-- æ—¥å†ç»„ä»¶ -->
  <calendar selectedDate="{{currentDate}}" show="{{showCalendar}}" bindselect="onDateSelect" bindclose="hideCalendar"></calendar>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="statistics-bar">
    <view class="stat-item">
      <text class="stat-label">æ€»æ¡”æ•°ï¼š</text>
      <text class="stat-value">{{statistics.totalJu}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">æ€»è´¡æ•°ï¼š</text>
      <text class="stat-value">{{statistics.totalGong}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">è®°å½•æ•°ï¼š</text>
      <text class="stat-value">{{statistics.totalCount}}</text>
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="records-list">
    <view wx:if="{{records.length === 0}}" class="empty-tip">
      æš‚æ— è®°å½•
    </view>
    <view wx:for="{{records}}" wx:key="_id" class="record-item">
      <view class="record-content">
        <view class="record-header">
          <view class="recorder-name">{{item.recorder}}</view>
          <view class="record-time">{{item.createTimeDisplay}}</view>
        </view>
        <view class="record-details">
          <view class="detail-row" wx:if="{{item.recipient}}">
            <text class="detail-label">æ”¶ä»¶äººï¼š</text>
            <text class="detail-value">{{item.recipient}}</text>
          </view>
          <view class="detail-row" wx:if="{{item.phone}}">
            <text class="detail-label">ç”µè¯ï¼š</text>
            <text class="detail-value">{{item.phone}}</text>
          </view>
          <view class="detail-row" wx:if="{{item.address}}">
            <text class="detail-label">åœ°å€ï¼š</text>
            <text class="detail-value address-text">{{item.address}}</text>
          </view>
          <view class="detail-row" wx:if="{{item.remark}}">
            <text class="detail-label">å¤‡æ³¨ï¼š</text>
            <text class="detail-value remark-text">{{item.remark}}</text>
          </view>
          <view class="detail-row quantity-row">
            <text class="quantity-item" wx:if="{{item.quantityJu > 0}}">{{item.quantityJu}}æ¡”</text>
            <text class="quantity-item" wx:if="{{item.quantityGong > 0}}">{{item.quantityGong}}è´¡</text>
          </view>
        </view>
      </view>
      <view class="delete-btn" data-id="{{item._id}}" data-index="{{index}}" bindtap="deleteRecord">
        <image class="delete-icon" src="../../image/delete.png" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="add-btn-wrapper">
    <button class="add-btn" bindtap="showAddModal">æ¥é¾™è§£æ</button>
  </view>

  <!-- æ·»åŠ å¼¹çª— -->
  <view wx:if="{{showAddModal}}" class="modal-mask" bindtap="hideAddModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç²˜è´´æ¥é¾™å†…å®¹</text>
        <view class="modal-close" bindtap="hideAddModal">Ã—</view>
      </view>
      <view class="modal-body">
        <textarea 
          class="paste-textarea" 
          placeholder="è¯·ç²˜è´´æ¥é¾™å†…å®¹ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è§£æ..."
          value="{{pasteContent}}"
          bindinput="onPasteInput"
          auto-height
          maxlength="5000"
        ></textarea>
        <view class="modal-tip">
          <text>ğŸ’¡ æç¤ºï¼šæ”¯æŒæ¥é¾™æ ¼å¼ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§£æè®°å½•äººã€åœ°å€ã€æ”¶ä»¶äººã€ç”µè¯ã€æ•°é‡ç­‰ä¿¡æ¯</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="hideAddModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm-btn" bindtap="parseAndSave">è§£æå¹¶ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>

