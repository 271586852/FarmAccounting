# 快递功能配置指南

## 一、创建快递数据库集合

### 1. 进入云开发控制台

1. 打开微信开发者工具
2. 点击顶部菜单栏的 **"云开发"** 按钮
3. 点击 **"数据库"** 标签

### 2. 创建 `express` 集合

1. 点击 **"+"** 按钮创建新集合
2. 集合名称输入：`express`
3. 点击 **"确定"**

### 3. 设置数据库权限

1. 在 `express` 集合中，点击 **"权限设置"**
2. 选择以下权限之一：
   - **所有用户可读写**（推荐，开发测试时使用）
   - **仅创建者可读写**（更安全，但需要用户登录）
   - **所有用户可读，仅创建者可写**

**注意**：如果选择"仅创建者可读写"，需要确保小程序已登录用户。

## 二、检查云开发环境配置

### 1. 确认环境 ID

打开 `miniprogram/config.js` 文件，确认 `envId` 已正确配置：

```javascript
const config = {
  envId: '你的环境ID',  // 例如：'cloud1-abc123' 或 'release-xxx'
}
```

### 2. 如果环境 ID 未配置

1. 在微信开发者工具中，点击 **"云开发"** 按钮
2. 点击 **"设置"** -> **"环境设置"**
3. 复制 **"环境ID"**
4. 在 `miniprogram/config.js` 中修改 `envId` 为你的环境ID

## 三、配置检查清单

- [ ] 已开通微信云开发服务
- [ ] 已创建云开发环境
- [ ] `miniprogram/config.js` 中的 `envId` 已正确配置
- [ ] 已创建数据库集合 `express`
- [ ] `express` 集合权限已正确设置
- [ ] 小程序基础库版本 >= 2.2.3（支持云开发）

## 四、快速测试

配置完成后，按以下步骤测试：

1. **测试添加快递记录**：
   - 进入"快递"页面
   - 点击"添加快递"按钮
   - 粘贴接龙内容，例如：
     ```
     1. Sunny 1、北京市密云区鸿泽园小区3号楼五单元301室，王涛：15915768168。（2桔）
     2. Sunny 2、北京市朝阳区通坝东路10号院9号楼1402室，申女士13651180722。（2桔）
     ```
   - 点击"解析并保存"
   - 应该显示"成功添加X条记录"

2. **测试查看记录**：
   - 在快递页面应该能看到刚才保存的记录
   - 统计栏应该显示总桔数、总贡数、记录数

3. **测试删除记录**：
   - 在快递页面点击删除按钮
   - 确认删除后，记录应该消失

## 五、数据结构说明

快递记录的数据结构：

```javascript
{
  _id: String,              // 自动生成
  date: String,             // 日期，格式：YYYY-MM-DD
  recorder: String,         // 记录人名称
  recipient: String,         // 收件人姓名
  phone: String,            // 手机号
  address: String,          // 地址
  quantityJu: Number,      // 桔的数量
  quantityGong: Number,     // 贡的数量
  originalText: String,     // 原始接龙文本
  createTime: Date,         // 创建时间
  updateTime: Date          // 更新时间
}
```

## 六、常见问题

### Q1: 提示"集合不存在"或"collection not found"
**A**: 在云开发控制台的数据库中创建名为 `express` 的集合。

### Q2: 提示"权限不足"或"permission denied"
**A**: 
- 检查数据库集合 `express` 的权限设置
- 开发阶段可以临时设置为"所有用户可读写"进行测试
- 如果使用"仅创建者可读写"，确保小程序已登录用户

### Q3: 解析失败或解析结果不正确
**A**: 
- 检查接龙内容格式是否正确
- 确保包含必要信息：地址、收件人、手机号、数量
- 支持单行和多行格式，详见解析规则

### Q4: 统计信息显示不正确
**A**: 
- 检查 `quantityJu` 和 `quantityGong` 字段是否正确解析
- 确保接龙内容中的数量格式正确（如：2桔、1贡1桔）

## 七、解析规则说明

系统支持以下格式的接龙内容：

### 单行格式
```
1. Sunny 1、北京市密云区鸿泽园小区3号楼五单元301室，王涛：15915768168。（2桔）
2. Sunny 2、北京市朝阳区通坝东路10号院9号楼1402室，申女士13651180722。（2桔）
```

### 多行格式
```
4. 恒昌    收件人：芷琪
收件地址：佛山市禅城区季华五路55号万科金融中心A座513室   
联系电话：18027683204
请选择顺丰快递(1贡1桔)
```

### 解析字段
- **记录人**：第一个空格前的名称（如：Sunny、恒昌、莲子）
- **收件人**：从"收件人："后提取，或从地址前提取
- **手机号**：11位数字
- **地址**：从"收件地址："后提取，或从内容中提取
- **数量**：从括号中提取（如：2桔、1贡1桔）

## 八、与记账功能的区别

| 功能 | 记账页面 | 快递页面 |
|------|---------|---------|
| 数据库集合 | `records` | `express` |
| 数据类型 | 农场产品记录 | 快递订单记录 |
| 添加方式 | 表单填写 | 粘贴接龙内容 |
| 统计信息 | 总数量、总重量、总邮费 | 总桔数、总贡数、记录数 |

两个功能使用不同的数据库集合，互不影响。

